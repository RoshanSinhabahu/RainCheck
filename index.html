<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cudu Manika</title>
    <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
    crossorigin="anonymous"
    >
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <style>
        body{
            background-image:url('src/jacket-raincoat.webp');
            background-repeat:no-repeat;
            background-size:cover;
            background-position:center;
        }
        ._container{
            padding:0px;
            margin:0px;
            flex-direction:column;
            backdrop-filter:blur(50px);
        }
        .frame{
            border-radius:50px;
            width:350px;
            height:350px;
            flex-direction:column;
            gap:30px;
            background-image:url('src/opening.webp');
            background-repeat:no-repeat;
            background-size:cover;
            box-shadow: 0 0px 30px rgba(0, 0, 0, 0.274);
        }
        .text-field{
            position:relative;
            top:9%;
            background-color:#00000046;
            width:80%;
            padding:10px;
            border-radius:30px;
            font-weight:500;
            backdrop-filter:blur(5px);
            text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.4);
        }
        .cityName{
            font-weight:100;
            font-size:1rem;
            text-align:center;
        }
        .advice{
            font-size:1.2rem;
            text-align:center;
        }
        .locationButton{
            position:absolute;
            border:none;
            border-radius:20px;
            background-color:rgba(0, 0, 0, 0.326);
            padding:10px;
            bottom:10%;
        }
        .locationButton:hover{
            background-color:rgba(255, 255, 255, 0.326);
        }
        .warning-field{
            display:none;
            background-color:#ff00006a;
            width:fit-content;
            padding:5px;
            border-radius:50px;
            font-weight:500;
            text-align:center;
            justify-content:center;
            align-items:center;
            gap:5px;
        }
        .warning-mark{
            color:rgb(255, 255, 255);
            font-size:1.5rem;
        }
    </style>
</head>
<body>
        <div class="_container d-flex justify-content-center align-items-center vh-100">
            <div id="frame" class="frame d-flex align-items-center">
                <div class="text-field">
                    <div id="cityDisplay" class="cityName text-white d-flex justify-content-center align-items-center">Hello</div>
                    <div id="Advice" class="advice text-white d-flex justify-content-center align-items-center">Have a great one!</div>
                </div>
                <div class="warning-field text-white"><i class="warning-mark bi-snow"></i> Snow warning !</div>
            </div>
            <button class="locationButton text-white" onclick="getAdvice()"><i class="bi-geo-alt"></i> Click Here</button>
        </div>
<script
  src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
  crossorigin="anonymous"
></script>
<script>
    const cityDisplay = document.getElementById('cityDisplay');
    const Advice = document.getElementById('Advice');
    const card_image = document.getElementById('frame');

    

    async function getAdvice(){
        if(navigator.geolocation){
            navigator.geolocation.getCurrentPosition(
                async (position) => {
                    const lat = position.coords.latitude;
                    const long = position.coords.longitude;

                    const apiKey='dbd7518c79ed5f36698bf4ef8009ff4f';
                    const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${long}&appid=${apiKey}&units=metric`);
                    const data = await response.json();

                    const Metroresponse = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${long}&daily=precipitation_probability_max,snowfall_sum&timezone=auto`);
                    const rainData = await Metroresponse.json();
                    const rainChance = rainData.daily.precipitation_probability_max[0];
                    
                    const gpsLocation = data.name;
                    const temp = data.main.temp;
                    const feelLike = Math.round(data.main.feels_like);
                    cityDisplay.innerText=`You are currently at ${gpsLocation}, You feel ${feelLike} Â°C`;
                    
                    if(temp<=20 && rainChance>=50){
                        Advice.innerText="Wear a jacket and bring raincoat.";
                        card_image.style.backgroundImage = "url('src/jacket-raincoat.webp')";
                    } else if(temp>20 && rainChance>=50) {
                        Advice.innerText="No need to wear a jacket but bring raincoat.";
                        card_image.style.backgroundImage = "url('src/no-jacket-raincoat.webp')";
                    } else if (temp<=20 && rainChance<50) {
                        Advice.innerText="Wear a jacket, no need the raincoat";
                        card_image.style.backgroundImage = "url('src/jacket-no-raincoat.webp')";
                    } else if (temp>20 && rainChance<50){
                        Advice.innerText="Perfect day, no need either jacket or raincoat";
                        card_image.style.backgroundImage = "url('src/no-jacket-no-raincoat.webp')";
                    }

                
                },
                (error) => {
                    cityDisplay.innerText="Error getting location :(";
                }
            )
        } else {
            cityDisplay.innerText="Geolocation is not supported by this browser.";
        }
    }
</script>
</body>
</html>