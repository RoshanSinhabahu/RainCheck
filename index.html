<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rain? Cold?</title>
    <link href="src/icon.png" type="image/x-icon" rel="icon">
    <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
    crossorigin="anonymous"
    >
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <style>
        body{
            background-image:url('src/jacket-raincoat.webp');
            background-repeat:no-repeat;
            background-size:cover;
            background-position:center;
        }
        ._container{
            padding:0px;
            margin:0px;
            flex-direction:column;
            backdrop-filter:blur(50px);
        }
        .frame{
            border-radius:50px;
            width:350px;
            height:350px;
            flex-direction:column;
            gap:30px;
            background-repeat:no-repeat;
            background-size:cover;
            box-shadow: 0 0px 30px rgba(0, 0, 0, 0.274);
        }
        .text-field{
            position:relative;
            top:9%;
            background-color:#00000046;
            width:80%;
            padding:10px;
            border-radius:30px;
            font-weight:500;
            backdrop-filter:blur(5px);
            text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.4);
        }
        .cityName{
            font-weight:100;
            font-size:1rem;
            text-align:center;
        }
        .advice{
            font-size:1.2rem;
            text-align:center;
        }
        .locationButton{
            position:absolute;
            border-radius:20px;
            background-color:rgba(0, 0, 0, 0.326);
            padding:10px;
            bottom:15%;
            border:7px solid rgba(157, 209, 255, 0.542);
        }
        .locationButton:hover{
            background-color:rgba(0, 0, 0, 0.528);
        }
        .locationButton:active{
            background-color:rgba(0, 0, 0, 0.179);
        }
        .warning-field{
            display:none;
            background-color:#ff00006a;
            width:fit-content;
            border-radius:50px;
            font-weight:500;
            text-align:center;
            justify-content:center;
            align-items:center;
            gap:5px;
            margin-top:10px;
            padding:5px 10px 5px 10px;
        }
        .warning-mark{
            color:rgb(255, 255, 255);
            font-size:1.5rem;
        }
        .loading{
            display:none;
            position:absolute;
            bottom:15%;
        }
    </style>
</head>
<body id="_body">
        <div class="_container d-flex justify-content-center align-items-center vh-100">
            <div id="frame" class="frame d-flex align-items-center">
                <div class="text-field">
                    <div id="cityDisplay" class="cityName text-white d-flex justify-content-center align-items-center">Hello</div>
                    <div id="Advice" class="advice text-white d-flex justify-content-center align-items-center">Have a great one!</div>
                </div>
                <div id="snow-warning" class="warning-field text-white"><i class="warning-mark bi-snow"></i> Snow warning !</div>
            </div>
            <div id="loading" class="loading">
                <img src="src/Loading.gif" alt="Loading..." />
            </div>
            <button class="locationButton text-white" onclick="getAdvice()"><i class="bi-geo-alt"></i> Click Here</button>
        </div>
<script
  src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
  crossorigin="anonymous"
></script>
<script>
    const cityDisplay = document.getElementById('cityDisplay');
    const Advice = document.getElementById('Advice');
    const card_image = document.getElementById('frame');
    const snow_warning = document.getElementById('snow-warning');
    const loading = document.getElementById("loading");
    const _body = document.getElementById("_body");
    const no_j_no_r = ['url(src/no_j_no_r/img1.webp)','url(src/no_j_no_r/img2.webp)','url(src/no_j_no_r/img3.webp)','url(src/no_j_no_r/img4.webp)'];
    const j_no_r = ['url(src/j_no_r/img1.webp)'];
    const no_j_r = ['url(src/no_j_r/img1.webp)','url(src/no_j_r/img2.webp)','url(src/no_j_r/img3.webp)','url(src/no_j_r/img4.webp)'];
    const j_r = ['url(src/j_r/img1.webp)','url(src/j_r/img2.webp)'];

    const imgIndex = Math.floor(Math.random() * no_j_no_r.length);
    card_image.style.backgroundImage = no_j_no_r[imgIndex];
    _body.style.backgroundImage = no_j_no_r[imgIndex];

    async function getAdvice(){
        loading.style.display = "flex";
        if(navigator.geolocation){
            navigator.geolocation.getCurrentPosition(
                async (position) => {
                    const lat = position.coords.latitude;
                    const long = position.coords.longitude;

                    const apiKey='dbd7518c79ed5f36698bf4ef8009ff4f';
                    const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${long}&appid=${apiKey}&units=metric`);
                    const data = await response.json();

                    const Metroresponse = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${long}&daily=precipitation_probability_max,snowfall_sum&timezone=auto`);
                    const metroData = await Metroresponse.json();
                    const rainChance = metroData.daily.precipitation_probability_max[0];
                    const snowChance = metroData.daily.snowfall_sum[0];
                    
                    const gpsLocation = data.name;
                    const temp = data.main.temp;
                    const feelLike = Math.round(data.main.feels_like);
                    cityDisplay.innerText=`You are currently in ${gpsLocation},
                    You feel ${feelLike} Â°C`;
                    
                    if(temp<=20 && rainChance>=50){
                        Advice.innerText="Wear a jersey and bring a raincoat.";
                        const imgIndex  =Math.floor(Math.random()*j_r.length);
                        card_image.style.backgroundImage = j_r[imgIndex];
                        _body.style.backgroundImage = j_r[imgIndex];
                    } else if(temp>20 && rainChance>=50) {
                        Advice.innerText="No need to wear a jersey but bring a raincoat.";
                        const imgIndex  =Math.floor(Math.random()*no_j_r.length);
                        card_image.style.backgroundImage = no_j_r[imgIndex];
                        _body.style.backgroundImage = no_j_r[imgIndex];
                    } else if (temp<=20 && rainChance<50) {
                        Advice.innerText="Wear a jersey, no need a raincoat.";
                        const imgIndex  =Math.floor(Math.random()*j_no_r.length);
                        card_image.style.backgroundImage = j_no_r[imgIndex];
                        _body.style.backgroundImage = j_no_r[imgIndex];
                    } else if (temp>20 && rainChance<50){
                        Advice.innerText="Perfect day, no need for either a jersey or a raincoat.";
                        const imgIndex  =Math.floor(Math.random()*j_no_r.length);
                        card_image.style.backgroundImage = no_j_no_r[imgIndex];
                        _body.style.backgroundImage = no_j_no_r[imgIndex];
                    }

                    if(snowChance>=40){
                        snow_warning.style.display = "flex";
                    } else {
                        snow_warning.style.display = "none";
                    }
                    loading.style.display = "none";
                },
                (error) => {
                    cityDisplay.innerText="Error getting location :(";
                    loading.style.display = "none";
                }
            )
        } else {
            cityDisplay.innerText="Geolocation is not supported by this browser.";
            loading.style.display = "none";
        }
    }
</script>
</body>
</html>